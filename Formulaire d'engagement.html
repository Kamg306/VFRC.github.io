<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire d'Engagement Championnat de France des Rallyes 2025</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
        }

        h2 {
            text-align: center; /* Centrer le titre */
        }

        .form-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }

        .column {
            width: 48%;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .required:after {
            content: " *"; /* Asterisk for required fields */
            color: red; /* Asterisk color */
        }

        input, select {
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: auto;
        }

        input[type="url"] {
            width: 60%; /* Reduce link field width */
        }

        input[type="text"].uppercase {
            text-transform: uppercase;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        h2, h3 {
            margin-bottom: 10px;
            color: #333;
        }

        input[type="radio"] {
            width: auto;
        }

        input[type="submit"] {
            width: auto;
            padding: 10px 20px;
            background-color: #7b7ffa; /* Button color */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        input[type="submit"]:hover {
            background-color: #6666cc; /* Hover color */
        }

        .thank-you-message {
            display: none;
            margin-top: 20px;
            color: #7b7ffa; /* Thank you message color */
            font-size: 16px;
            font-weight: bold;
            text-align: center;
        }

        .flag-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .country-flag {
            width: 1.5em; /* Flag image size */
            height: auto; /* Maintain aspect ratio */
        }
    </style>
</head>
<body>
    <div id="form-container">
        <form id="rallye-form" onsubmit="displayThankYouMessage(event)">
            <h2>ðŸ“‹ Formulaire d'Engagement Championnat de France des Rallyes 2025</h2>
            <div class="form-container">
                <!-- Left Column - Pilot Info -->
                <div class="column">
                    <h3>Informations Pilote</h3>
                    <label for="nom" class="required">NOM :</label>
                    <input type="text" id="nom" name="nom" class="uppercase" required>

                    <label for="prenom" class="required">PrÃ©nom :</label>
                    <input type="text" id="prenom" name="prenom" required>

                    <label for="code-asa" class="required">Code ASA :</label>
                    <div class="flag-input">
                        <select id="pays" name="pays" required onchange="updateCountryFlag()">
                            <option value="">SÃ©lectionnez un pays...</option>
                            <option value="FR">France</option>
                            <option value="BE">Belgique</option>
                            <option value="CH">Suisse</option>
                            <option value="ES">Espagne</option>
                            <option value="PT">Portugal</option>
                        </select>
                        <img id="country-flag" class="country-flag" src="" alt="Drapeau" style="display: none;"/>
                    </div>

                    <label for="departement" class="required">DÃ©partement :</label>
                    <input type="text" id="departement" name="departement" maxlength="2" required placeholder="Ex: 75">

                    <label for="numero" class="required">NÂ° souhaitÃ© pour la saison 2025 :</label>
                    <select id="numero" name="numero" required></select>

                    <label for="id-steam">ID Steam :</label>
                    <input type="text" id="id-steam" name="id-steam">

                    <label for="team">Team :</label>
                    <input type="text" id="team" name="team"> <!-- Champ non obligatoire -->
                </div>

                <!-- Right Column - Car Info -->
                <div class="column">
                    <h3>Informations Voiture</h3>
                    <label for="constructeur" class="required">Constructeur :</label>
                    <select id="constructeur" name="constructeur" required onchange="updateModelOptions()">
                        <option value="">SÃ©lectionnez un constructeur...</option>
                        <option value="Peugeot">Peugeot</option>
                        <option value="CitroÃ«n">CitroÃ«n</option>
                        <option value="Renault">Renault</option>
                        <option value="BMW">BMW</option>
                        <option value="Porsche">Porsche</option>
                        <option value="Alpine">Alpine</option>
                        <option value="Skoda">Skoda</option>
                        <option value="Mitsubishi">Mitsubishi</option>
                        <option value="Hyundai">Hyundai</option>
                        <option value="Volkswagen">Volkswagen</option>
                        <option value="Ford">Ford</option>
                    </select>

                    <label for="modele" class="required">ModÃ¨le :</label>
                    <select id="modele" name="modele" required onchange="updateGroupClass()"></select>

                    <label for="groupe" class="required">Groupe :</label>
                    <select id="groupe" name="groupe" required>
                        <option value="">SÃ©lectionnez un groupe...</option>
                    </select>

                    <label for="classe" class="required">Classe :</label>
                    <select id="classe" name="classe" required>
                        <option value="">SÃ©lectionnez une classe...</option>
                    </select>

                    <label for="skin" class="required">Skin fourni :</label> <!-- Label modifiÃ© ici -->
                    <div class="radio-group">
                        <input type="radio" id="skin-oui" name="skin" value="Oui" required>
                        <label for="skin-oui">Oui</label>
                        
                        <input type="radio" id="skin-non" name="skin" value="Non" required>
                        <label for="skin-non">Non</label>
                    </div>

                    <label for="lien-skin">Lien du Skin :</label> <!-- Label pour le lien du skin -->
                    <input type="url" id="lien-skin" name="lien-skin" placeholder="Entrez le lien ici..."> <!-- Ajout d'un placeholder -->
                </div>
            </div>
            <input type="submit" value="Envoyer">
        </form>
    </div>

    <div id="thank-you-message" class="thank-you-message">
        Merci pour votre engagement au Championnat de France des Rallyes 2025 !<br>
        N'oubliez pas de consulter les autres onglets du site.
    </div>

    <script>
        const takenNumbers = new Set(JSON.parse(localStorage.getItem('takenNumbers')) || []);

        function populateNumberOptions() {
    const numeroSelect = document.getElementById("numero");
    numeroSelect.innerHTML = ""; // Vider les options existantes

    // RÃ©cupÃ©rer les numÃ©ros dÃ©jÃ  pris
    let takenNumbers = JSON.parse(localStorage.getItem('takenNumbers')) || [];

    // GÃ©nÃ©rer une liste de numÃ©ros disponibles (ajustez selon vos besoins)
    const availableNumbers = [...Array(150).keys()].map(n => n + 1); // Exemple : numÃ©ros de 1 Ã  150

    availableNumbers.forEach(numero => {
        if (!takenNumbers.includes(numero.toString())) { // VÃ©rifier si le numÃ©ro n'est pas dÃ©jÃ  pris
            const option = document.createElement("option");
            option.value = numero;
            option.textContent = numero;
            numeroSelect.appendChild(option);
        }
    });
}

        const modelGroupsClasses = {
            "Peugeot": {
                "207": { groupe: "F RC2", classe: "A7S" },
                "306": { groupe: "F Rally Nat", classe: "A7K" },
                "205 GTI": { groupe: "F Rally Nat", classe: "F2/14" },
                "208": { groupe: "F RC4", classe: "Rally4" },
                "206": { groupe: "F RC4", classe: "A6K" },
                "106": { groupe: "F RC4", classe: "F2/13" },
                "205 Rallye": { groupe: "F RC4", classe: "F2/13" }
            },
            "CitroÃ«n": {
                "C3": { groupe: "F RC2", classe: "Rally2/R5" },
                "Saxo": { groupe: "F RC4", classe: "A6K" }
            },
            "Renault": {
                "MÃ©gane": { groupe: "F Rally Nat", classe: "A7K" },
                "Clio II RS": { groupe: "F Rally Nat", classe: "F2/14" },
                "Clio I 16S": { groupe: "F Rally Nat", classe: "F2/14" },
                "Clio": { groupe: "F RC4", classe: "A6K" },
                "Clio IV": { groupe: "F RC4", classe: "Rally4" }
            },
            "BMW": {
                "M3 E30": { groupe: "F Rally Nat", classe: "A8" }
            },
            "Porsche": {
                "911 GT3 Cup": { groupe: "F RGT", classe: "GT+" }
            },
            "Alpine": {
                "A110": { groupe: "F RGT", classe: "RGT" }
            },
            "Skoda": {
                "Fabia": { groupe: "F RC2", classe: "A7S" },
                "Fabia Evo": { groupe: "F RC2", classe: "Rally2/R5" }
            },
            "Mitsubishi": {
                "Lancer Evo VIII": { groupe: "F Rally Nat", classe: "A8" }
            },
            "Hyundai": {
                "I20": { groupe: "F RC2", classe: "Rally2/R5" }
            },
            "Volkswagen": {
                "Polo GTI": { groupe: "F RC2", classe: "Rally2/R5" }
            },
            "Ford": {
		"Fiesta": { groupe: "F RC2", classe: "A7S" },
                "Fiesta MKI": { groupe: "F RC2", classe: "Rally2/R5" }
            }
        };

        function updateModelOptions() {
            const constructeur = document.getElementById("constructeur").value;
            const modeleSelect = document.getElementById("modele");

            modeleSelect.innerHTML = ""; // Clear existing options

            const models = Object.keys(modelGroupsClasses[constructeur]);

            models.forEach(model => {
                const option = document.createElement("option");
                option.value = model;
                option.textContent = model;
                modeleSelect.appendChild(option);
            });

            if (models.length > 0) {
                modeleSelect.value = models[0]; // Select the first model by default
                updateGroupClass(); // Update group and class for the first model
            }
        }

        function updateGroupClass() {
            const constructeur = document.getElementById("constructeur").value;
            const modele = document.getElementById("modele").value;
            const groupeSelect = document.getElementById("groupe");
            const classeSelect = document.getElementById("classe");

            groupeSelect.innerHTML = ""; // Clear existing options
            classeSelect.innerHTML = ""; // Clear existing options

            const groupClassInfo = modelGroupsClasses[constructeur][modele];

            if (groupClassInfo) {
                const optionGroupe = document.createElement("option");
                optionGroupe.value = groupClassInfo.groupe;
                optionGroupe.textContent = groupClassInfo.groupe;
                groupeSelect.appendChild(optionGroupe);

                const optionClasse = document.createElement("option");
                optionClasse.value = groupClassInfo.classe;
                optionClasse.textContent = groupClassInfo.classe;
                classeSelect.appendChild(optionClasse);
            }
        }

        function updateCountryFlag() {
            const countrySelect = document.getElementById("pays");
            const flagImg = document.getElementById("country-flag");
            const countryCode = countrySelect.value;

            if (countryCode) {
                flagImg.src = https://flagpedia.net/data/flags/w580/${countryCode.toLowerCase()}.webp;
                flagImg.style.display = "inline";
            } else {
                flagImg.src = "";
                flagImg.style.display = "none";
            }
        }

        function displayThankYouMessage(event) {
            event.preventDefault(); // Prevent form submission
            const thankYouMessage = document.getElementById("thank-you-message");
            thankYouMessage.style.display = "block"; // Show thank you message

            const formData = new FormData(event.target);
            const numeroValue = formData.get("numero");

            if (takenNumbers.has(numeroValue)) {
                alert('Les donnÃ©es pour ce numÃ©ro existent dÃ©jÃ .');
                return; // Do nothing if the data already exists
            }

            takenNumbers.add(numeroValue); // Add number to takenNumbers
            localStorage.setItem('takenNumbers', JSON.stringify(Array.from(takenNumbers))); // Store in localStorage

            const engagementData = {};
            formData.forEach((value, key) => {
                engagementData[key] = value;
            });

            localStorage.setItem('engagement_' + numeroValue, JSON.stringify(engagementData)); // Save form data

            const form = event.target;
            form.style.display = "none"; // Hide the form

            setTimeout(() => {
                thankYouMessage.style.display = "none"; // Hide after 5 seconds
                form.reset(); // Reset form fields
                form.style.display = "block"; // Show form again
                populateNumberOptions(); // Refresh number options
            }, 5000);

            document.getElementById("form-container").style.display = "none"; // Hide form after submission
        }

        window.onload = function() {
            populateNumberOptions(); // Populate number options on page load
        };
    </script>
</body>
</html>